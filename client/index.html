<!DOCTYPE html>
<html>
<head>
    <title>网络棋牌室</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!--<link rel="stylesheet" type="text/css" href="http://localhost/arcgis_js_api/library/3.6/3.6/js/dojo/dijit/themes/claro/claro.css"/>-->
    <link rel="stylesheet" type="text/css" href="./css/master.css">
    <script type="text/javascript" src="/socket.io/socket.io.js"></script>
    <script type="text/javascript" src="./js/config.js"></script>
    <script type="text/javascript" src="./js/Parser.js"></script>
    <script type="text/javascript" src="./js/Render.js"></script>
    <script type="text/javascript" src="./js/Socket.js"></script>
    <script type="text/javascript" src="./js/ChessGame.js"></script>

    <script type="text/javascript">
        function start() {
            var chessImgs = {
                'a1': './images/a1.gif',
                'a2': './images/a2.gif',
                'a3': './images/a3.gif',
                'a4': './images/a4.gif',
                'a5': './images/a5.gif',
                'a6': './images/a6.gif',
                'a7': './images/a7.gif',
                'b1': './images/b1.gif',
                'b2': './images/b2.gif',
                'b3': './images/b3.gif',
                'b4': './images/b4.gif',
                'b5': './images/b5.gif',
                'b6': './images/b6.gif',
                'b7': './images/b7.gif',
                'bg': './images/bg.gif',
                'chessbg': './images/chessbg.gif',
                'bg_sel': './images/bg_sel.gif',
                'bg_over': './images/bg_over.gif'
            };


            app = new ChessGame();
            Render.drawChessBoard(canvas);
            wsParser.app = app;
            app.preloadImg(chessImgs);
            Socket = SocketIo();


            var w = (screen.width - 506) / 2;
            var left = document.getElementsByClassName('left')[0];
            var right = document.getElementsByClassName('right')[0];
            var rw = screen.width - 506 - w;
            left.style.width = w + 'px';
            right.style.width = rw + 'px';
        }

        window.onbeforeunload = function(evt){
            Socket.close(userName, rivalName);

            // 延迟三秒，以便socket传送数据
            var start = Date.now();
            var end = Date.now();
            while(end - start < 3000){
                end = Date.now();
            }
        }
    </script>
</head>
<body onload="start();">
<div class="container">
    <div class="thr">
        <div class="content">
            <div class="mainBoxCenter">
                <canvas id="chessBoard" width="500" height="550" ></canvas>
            </div>
        </div>
        <div class="left">&nbsp</div>
        <div class="right">&nbsp</div>
    </div>
</div>
<!-- end TabContainer -->
</body>
</html>
